import hashmap_4fun;
import java.util.HashMap;
import java.util.Scanner;
import java.util.Map;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileNotFoundException;
public class Main
{
	 private static HashMap<String, pessoa > people = new HashMap<>();
    private static Scanner input = new Scanner(System.in);
	private static final String FILE_NAME = "people.txt";
	
	public static void savepeopletofile(){
	    try (BufferedWriter writer = new BufferedWriter(new FileWriter(FILE_NAME))) {
   for(Map.Entry<String, Integer> entry : people.entrySet()){
	       Person person = entry.getValue(); 
            writer.write(pessoa.getName() + "," + pessoa.getAge()); 
            writer.newLine();
	   }
} catch (IOException e) {
    System.out.println("Erro ao salvar no arquivo: " + e.getMessage());
}
	    
	}
	public static void loadfromfile(){
	    
	    try(BufferedReader reader = new BufferedReader(new FileReader(FILE_NAME))){
	   String metric;
  while ((metric = reader.readLine()) != null) {
    String[] splits = metric.split(",");
    if (splits.length == 2) {
        String name = splits[0];
        int age = Integer.parseInt(splits[1]);
        Person person = new Person(name, age);
                people.put(name, person);
    }
}
	    }catch(FileNotFoundException e) {
    System.out.println("Arquivo de dados não encontrado. Um novo será criado ao salvar.");
} catch (IOException e) {
    System.out.println("Erro ao ler o arquivo: " + e.getMessage());
}
	}
	
		public static String searchperson(){
	    System.out.println(" enter a name for search: ");
      String user_search = input.nextLine();
	  Person personfound = people.get(user_search.toLowerCase());
	 if (personfound != null){
	     System.out.println( user_search + " : " + personfound.getAge()+ " years");
	 }
	 else {
	 System.out.println("Theres no one with that name \n \n ");
	 }
	 return user_search;
	}
	
	public static void register(){
	    System.out.println("enter the name of the person: ");
    String person_name = input.nextLine().toLowerCase();
    System.out.println("enter the age of the person: ");
    if (input.hasNextInt()) {
        Integer person_age = input.nextInt();
        input.nextLine();
        Pessoa novaPessoa = new Pessoa(person_name, person_age);
        people.put(person_name, novaPessoa);
        System.out.println("person is now registered! \n ");
    } else {
        System.out.println("the age is invalid");
        input.nextLine();
    }
	}
	
	public static void main(String[] args) {
    loadfromfile();
	while (true){
        System.out.println(" Welcome to the register of people! \n please select a option \n 1- enter a new name and age \n 2-search a person \n 3-list \n 4-remove a person \n 5- exit ");
        if (input.hasNextInt()){
        Integer menu_op = input.nextInt();
        input.nextLine();
        
      switch( menu_op){
           
       case 1 :
           register();
             savepeopletofile();
             break;
        
        case 2:
	searchperson();
        break;
        
    case 3:
System.out.println("--List of people-- \n \n");
    for (Map.Entry<String, Pessoa> entry : people.entrySet()) {
        Pessoa pessoa = entry.getValue(); // Obtém o objeto
        System.out.println("name: " + pessoa.getNome() + ", age: " + pessoa.getIdade());
    }
    break;
    case 4:
            	String removed_user = searchperson();
            	if(people.remove(removed_user.toLowerCase()) != null){
            	System.out.println("The user is removed");
            	}
            	else{
            	  System.out.println("user was not found ");
            	}
            	savepeopletofile();
            	break;

    case 5:
         input.close();
            savepeopletofile();
            return;
	 
	 default:
	    System.out.println(" error in the option please try again \n \n ");
 break;
	 
	}
	}else{
	    System.out.println(" error in the option please try again \n \n ");
	    input.nextLine();
	}
	}

	}
}
